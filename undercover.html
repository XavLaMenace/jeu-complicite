<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Undercover</title>
    <link rel="stylesheet" href="style.css">
    <style>
        /* Styles sp√©cifiques ajout√©s pour la V2 */
        .player-vote-btn {
            background: #1a1a1a;
            border: 1px solid #444;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            color: white;
            font-size: 1.1rem;
            width: 100%;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .player-vote-btn:hover { border-color: var(--neon-orange); background: #222; }
        
        .eliminated-log {
            font-size: 0.9rem;
            color: #888;
            border-bottom: 1px solid #333;
            padding: 8px 0;
            display: flex;
            justify-content: space-between;
        }

        .status-header {
            text-align: center;
            margin-bottom: 20px;
            padding: 15px;
            background: #1a1a1a;
            border-radius: 10px;
            border: 1px solid var(--neon-orange);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="top-nav"><a href="index.html" class="btn-home">üè†</a></div>

        <div id="uc-setup">
            <h1 style="color:var(--neon-orange); text-shadow: 0 0 10px rgba(255, 61, 0, 0.4);">Undercover</h1>
            <p class="tagline" style="border:none;">√âdition ICAM</p>
            <div class="config-box">
                <div class="role-counter">
                    <span style="color:var(--neon-orange); font-weight:bold;">üïµÔ∏è Undercovers</span>
                    <input type="number" id="uc-count" value="1" min="1" max="3" style="width:50px; padding:5px; background:#000; border:1px solid #444; color:white; border-radius:4px;">
                </div>
                <div class="role-counter">
                    <span style="color:#aaa; font-style:italic;">üëª Mr. White</span>
                    <input type="number" id="white-count" value="0" min="0" max="2" style="width:50px; padding:5px; background:#000; border:1px solid #444; color:white; border-radius:4px;">
                </div>
                <div style="width:100%; height:1px; background:#333; margin: 10px 0;"></div>
                <label>Joueurs (Min. 3)</label>
                <div id="uc-players-container" style="display:flex; flex-direction:column; gap:10px;"></div>
                <button class="btn btn-neutral" onclick="addUcPlayer()" style="margin-top:10px; border:1px dashed #555;">+ Ajouter Joueur</button>
            </div>
            <button class="btn btn-orange" onclick="startUndercoverGame()" style="margin-top:15px;">Commencer la distribution</button>
        </div>

        <div id="uc-distrib" class="hidden" style="height:100%; display:flex; flex-direction:column; justify-content:center;">
            <h2 id="distrib-title" style="color:#888; font-size:1.2rem; font-weight:300; text-transform:uppercase;">Passe le t√©l√©phone √†...</h2>
            <h1 id="distrib-player-name" style="color:var(--neon-orange); font-size:2.5rem; margin-bottom:30px; text-shadow: 0 0 15px rgba(255, 61, 0, 0.5);">JOUEUR</h1>
            <div id="uc-hold-btn" class="hold-zone" style="height:200px; flex-grow:0;">
                <div id="uc-instruction">üëÜ MAINTIENS POUR VOIR TON MOT SECRET</div>
                <div id="uc-word-display" style="display:none; font-size:2rem; font-weight:bold; color:white;">MOT</div>
            </div>
            <button id="btn-next-distrib" class="btn btn-neutral hidden" onclick="nextDistrib()" style="margin-top:20px;">Joueur Suivant ‚ûî</button>
        </div>

        <div id="uc-game" class="hidden" style="height:100%; display:flex; flex-direction:column;">
            <h1 style="color:var(--neon-orange);">En Jeu</h1>
            
            <div id="starter-info" class="status-header">
                <span style="color:#888; font-size:0.9rem;">C'est √†</span><br>
                <strong id="starter-name" style="font-size:1.5rem; color:white;">JOUEUR</strong><br>
                <span style="color:#888; font-size:0.9rem;">de commencer le d√©bat !</span>
            </div>

            <p style="color:#aaa; font-size:0.9rem; margin-bottom:10px;">Cliquez sur un joueur pour l'√©liminer :</p>
            
            <div id="voting-list" style="flex-grow:1; overflow-y:auto;">
                </div>

            <div style="margin-top:10px; padding-top:10px; border-top:1px solid #333;">
                <h4 style="margin:0 0 10px 0; color:#666;">√âlimin√©s :</h4>
                <div id="eliminated-container" style="max-height:100px; overflow-y:auto;"></div>
            </div>
        </div>
    </div>

    <div id="modal-white-guess" class="modal-overlay hidden">
        <div class="modal-content">
            <h2 style="color:white;">üëª MR. WHITE !</h2>
            <p>Tu es √©limin√©, mais tu peux gagner si tu devines le mot des Civils.</p>
            <input type="text" id="white-guess-input" placeholder="Entre le mot..." style="margin: 15px 0; border:1px solid #fff;">
            <button class="btn btn-orange" onclick="checkWhiteGuess()">Valider</button>
            <button class="btn btn-neutral" onclick="whiteFail()">Je ne sais pas</button>
        </div>
    </div>

    <div id="modal-victory" class="modal-overlay hidden">
        <div class="modal-content">
            <h1 style="font-size:3rem;">üèÜ</h1>
            <h2 id="winner-role" style="color:white;">VICTOIRE</h2>
            <p id="victory-details" style="color:#aaa;"></p>
            <button class="btn btn-primary" onclick="resetUndercover()" style="margin-top:20px;">Rejouer</button>
        </div>
    </div>

    <script>
        const icamWords = [
            { civ: "Semaine de l'ART", und: "F√©ria du Bar" }, { civ: "Rattrapage", und: "Redoublement" }, 
            { civ: "Ing√©nieur", und: "Technicien" }, { civ: "Stage", und: "Alternance" }, 
            { civ: "IPSA", und: "INSA" }, { civ: "TP", und: "TD" }, { civ: "BDE", und: "BDS" }, 
            { civ: "Int√©gration", und: "Bizutage" }, { civ: "Projet", und: "Dossier" },
            { civ: "Dipl√¥me", und: "Certificat" }, { civ: "Nuit de l'ICAM", und: "BH" }, 
            { civ: "Foyer", und: "Bar" }, { civ: "Batiment A", und: "Batiment K" }, 
            { civ: "Allemand", und: "Espagnol" }, { civ: "Amphi", und: "Salle de classe" }, 
            { civ: "Partiel", und: "Examen" }, { civ: "Calculatrice", und: "R√®gle √† calcul" },
            { civ: "SolidWorks", und: "Catia" }, { civ: "Thermodynamique", und: "M√©canique des fluides" },
            { civ: "CAO", und: "DAO" }, { civ: "Mat√©riaux", und: "Structures" },
            { civ: "Compte-rendu", und: "Rapport" }, { civ: "√âlectronique", und: "Automatisme" },
            { civ: "Arduino", und: "Raspberry Pi" }, { civ: "Usinage", und: "Soudure" },
            { civ: "Imprimante 3D", und: "D√©coupe laser" }, { civ: "Atelier", und: "Laboratoire" },
            { civ: "Erasmus", und: "S√©jour √† l'√©tranger" }, { civ: "Soutenance", und: "Pr√©sentation orale" },
            { civ: "Physique", und: "Chimie" }, { civ: "Bi√®re", und: "Cidre" },
            { civ: "Pinte", und: "Demi" }, { civ: "Tireuse", und: "F√ªt" },
            { civ: "Shot", und: "Cocktail" }, { civ: "WEI", und: "D√©sint√©gration" },
            { civ: "Gala", und: "Soir√©e" }, { civ: "Fanfare", und: "Pompom" },
            { civ: "Bi√®re de No√´l", und: "Bi√®re de Printemps" }, { civ: "√âlections BDE", und: "Passation" },
            { civ: "Sponsoring", und: "Partenariat" }, { civ: "Goodies", und: "Pull de promo" },
            { civ: "Forum Entreprises", und: "Job Dating" }, { civ: "Afterwork", und: "Ap√©ro" },
            { civ: "D√©guisement", und: "Th√®me de soir√©e" }, { civ: "Tr√©sorier", und: "Pr√©sident d'asso" },
            { civ: "Barbecue", und: "Plancha" }, { civ: "Cuisine commune", und: "R√©fectoire" },
            { civ: "Appartement", und: "Chambre" }, { civ: "Plat de p√¢tes", und: "Riz" },
            { civ: "Lave-linge", und: "S√®che-linge" }, { civ: "M√©nage", und: "Vaisselle" },
            { civ: "Voisin de palier", und: "Colocataire" }, { civ: "Micro-ondes", und: "Four" },
            { civ: "Cafeti√®re", und: "Bouilloire" }, { civ: "Poubelle de tri", und: "D√©chetterie" },
            { civ: "Gardien", und: "Concierge" }, { civ: "Canap√©", und: "Fauteuil" },
            { civ: "Wifi", und: "Bluetooth" }, { civ: "Perceuse", und: "Visseuse" },
            { civ: "Moteur", und: "Batterie" }, { civ: "Vis", und: "Boulon" },
            { civ: "Marteau", und: "Masse" }, { civ: "Tournevis", und: "Cl√© √† molette" },
            { civ: "Fer √† souder", und: "Pistolet √† colle" }, { civ: "V√©lo", und: "Trottinette" },
            { civ: "Covoiturage", und: "Train" }, { civ: "Iphone", und: "Android" },
            { civ: "Macbook", und: "PC portable" }, { civ: "Casque audio", und: "√âcouteurs" },
            { civ: "Souris", und: "Clavier" }, { civ: "Major de promo", und: "D√©l√©gu√©" },
            { civ: "Sommeil", und: "Sieste" }, { civ: "Caf√©", und: "Th√©" },
            { civ: "Sms", und: "Mail" }, { civ: "Vacances", und: "Week-end" },
            { civ: "Lundi matin", und: "Vendredi soir" }, { civ: "Pizza", und: "Kebab" },
            { civ: "Burger", und: "Tacos" }
        ];

        let ucPlayers = ["Joueur 1", "Joueur 2", "Joueur 3"];
        let ucGameData = [];
        let currentDistribIndex = 0;
        let currentCivWord = ""; // Pour v√©rifier Mr White

        // --- SETUP FUNCTIONS ---
        function renderUcSetup() {
            const container = document.getElementById('uc-players-container');
            container.innerHTML = "";
            ucPlayers.forEach((player, index) => {
                const row = document.createElement('div');
                row.className = 'config-row';
                const input = document.createElement('input');
                input.value = player;
                input.onchange = (e) => ucPlayers[index] = e.target.value;
                input.placeholder = "Nom du Joueur";
                row.appendChild(input);
                if (ucPlayers.length > 3) {
                    const btnDel = document.createElement('button'); btnDel.innerText = "‚úï";
                    btnDel.className = "btn btn-danger btn-icon"; btnDel.onclick = () => removeUcPlayer(index);
                    row.appendChild(btnDel);
                }
                container.appendChild(row);
            });
        }
        function addUcPlayer() { ucPlayers.push(`Joueur ${ucPlayers.length + 1}`); renderUcSetup(); }
        function removeUcPlayer(index) { if (ucPlayers.length <= 3) return; ucPlayers.splice(index, 1); renderUcSetup(); }

        // --- GAME START ---
        function startUndercoverGame() {
            const validPlayers = ucPlayers.filter(p => p.trim() !== "");
            const nbUnder = parseInt(document.getElementById('uc-count').value);
            const nbWhite = parseInt(document.getElementById('white-count').value);
            if (validPlayers.length < 3) { alert("Min. 3 joueurs !"); return; }
            if (nbUnder + nbWhite >= validPlayers.length) { alert("Il faut au moins 1 Civil !"); return; }

            // Choix des mots
            const pair = icamWords[Math.floor(Math.random() * icamWords.length)];
            currentCivWord = pair.civ; // On garde le mot civil pour Mr White

            let roles = [];
            for(let i=0; i<nbUnder; i++) roles.push({ role: 'under', word: pair.und });
            for(let i=0; i<nbWhite; i++) roles.push({ role: 'white', word: "Tu es Mr. White (Pas de mot)" });
            while(roles.length < validPlayers.length) roles.push({ role: 'civil', word: pair.civ });
            roles.sort(() => Math.random() - 0.5);
            
            ucGameData = validPlayers.map((name, i) => ({ 
                name: name, 
                role: roles[i].role, 
                word: roles[i].word,
                alive: true // Nouveau : statut en vie
            }));

            currentDistribIndex = 0;
            document.getElementById('uc-setup').classList.add('hidden');
            document.getElementById('uc-distrib').classList.remove('hidden');
            showDistribScreen();
        }

        function showDistribScreen() {
            const data = ucGameData[currentDistribIndex];
            document.getElementById('distrib-player-name').innerText = data.name;
            document.getElementById('uc-word-display').innerText = data.word;
            document.getElementById('uc-word-display').style.display = 'none';
            document.getElementById('uc-instruction').style.display = 'block';
            document.getElementById('btn-next-distrib').classList.add('hidden');
            document.getElementById('distrib-title').innerText = "Passe le t√©l√©phone √†...";
        }

        function nextDistrib() {
            currentDistribIndex++;
            if (currentDistribIndex >= ucGameData.length) {
                // FIN DISTRIB -> LANCEMENT JEU
                initGamePhase();
            } else { showDistribScreen(); }
        }

        // --- GAMEPLAY PHASE ---
        function initGamePhase() {
            document.getElementById('uc-distrib').classList.add('hidden'); 
            document.getElementById('uc-game').classList.remove('hidden');
            document.getElementById('eliminated-container').innerHTML = "";
            
            // 1. Choisir qui commence
            const starter = ucGameData[Math.floor(Math.random() * ucGameData.length)];
            document.getElementById('starter-name').innerText = starter.name;

            // 2. Afficher les boutons de vote
            renderVotingList();
        }

        function renderVotingList() {
            const list = document.getElementById('voting-list');
            list.innerHTML = "";

            ucGameData.forEach((p, index) => {
                if(p.alive) {
                    const btn = document.createElement('div');
                    btn.className = 'player-vote-btn';
                    btn.innerHTML = `<span>${p.name}</span> <span style="font-size:0.8rem; color:#666;">Voter ‚ò†Ô∏è</span>`;
                    btn.onclick = () => eliminatePlayer(index);
                    list.appendChild(btn);
                }
            });
        }

        function eliminatePlayer(index) {
            const p = ucGameData[index];
            if(!confirm(`√ätes-vous s√ªr d'√©liminer ${p.name} ?`)) return;

            p.alive = false;
            
            // Log √©limination
            const logDiv = document.getElementById('eliminated-container');
            let roleName = "Civil";
            let roleColor = "#00e676"; // Vert
            if(p.role === 'under') { roleName = "Undercover"; roleColor = "#ff3d00"; } // Orange
            if(p.role === 'white') { roleName = "Mr. White"; roleColor = "#fff"; } // Blanc

            const entry = document.createElement('div');
            entry.className = 'eliminated-log';
            entry.innerHTML = `<span>${p.name}</span> <span style="color:${roleColor}">${roleName}</span>`;
            logDiv.prepend(entry); // Ajoute au d√©but

            // Si c'est Mr White -> Chance de gagner
            if(p.role === 'white') {
                triggerWhiteGuess();
                return; // On attend la r√©ponse de White avant de v√©rifier la fin
            }

            renderVotingList();
            checkWinCondition();
        }

        // --- LOGIQUE MR WHITE ---
        function triggerWhiteGuess() {
            document.getElementById('white-guess-input').value = "";
            document.getElementById('modal-white-guess').classList.remove('hidden');
        }

        function checkWhiteGuess() {
            const guess = document.getElementById('white-guess-input').value.trim().toLowerCase();
            const target = currentCivWord.toLowerCase();
            
            // Comparaison souple (contient le mot ou distance Levenshtein simple... ici simple √©galit√©/inclusion)
            if(guess === target || (guess.length > 3 && target.includes(guess))) {
                triggerVictory("Mr. White", "Il a trouv√© le mot : " + currentCivWord);
            } else {
                whiteFail();
            }
        }

        function whiteFail() {
            document.getElementById('modal-white-guess').classList.add('hidden');
            alert("Rat√© ! Le mot n'est pas trouv√©.");
            renderVotingList();
            checkWinCondition();
        }

        // --- CONDITIONS DE VICTOIRE ---
        function checkWinCondition() {
            const livingBadGuys = ucGameData.filter(p => p.alive && (p.role === 'under' || p.role === 'white')).length;
            const livingCivils = ucGameData.filter(p => p.alive && p.role === 'civil').length;
            
            // Cas 1 : Plus de m√©chants -> Civils gagnent
            if(livingBadGuys === 0) {
                triggerVictory("Les Civils", "Tous les imposteurs ont √©t√© √©limin√©s !");
                return;
            }

            // Cas 2 : M√©chants majoritaires (ou √©galit√©) -> M√©chants gagnent
            // (Standard undercover : si 1 civil vs 1 under, l'under gagne car il connait les autres under s'il en reste)
            if(livingBadGuys >= livingCivils) {
                triggerVictory("Les Imposteurs", "Ils sont en surnombre !");
                return;
            }
        }

        function triggerVictory(winnerName, details) {
            document.getElementById('winner-role').innerText = winnerName + " gagnent !";
            document.getElementById('victory-details').innerText = details;
            document.getElementById('modal-victory').classList.remove('hidden');
        }

        function resetUndercover() { 
            document.getElementById('modal-victory').classList.add('hidden');
            document.getElementById('modal-white-guess').classList.add('hidden');
            document.getElementById('uc-game').classList.add('hidden'); 
            document.getElementById('uc-setup').classList.remove('hidden'); 
        }

        // --- HOLD BTN LOGIC ---
        const ucHoldBtn = document.getElementById('uc-hold-btn'); 
        const ucWord = document.getElementById('uc-word-display'); 
        const ucInst = document.getElementById('uc-instruction');

        const showUc = (e) => { 
            if(e.cancelable) e.preventDefault(); 
            ucWord.style.display='block'; 
            ucInst.style.display='none'; 
        };
        const hideUc = (e) => { 
            if(e.cancelable) e.preventDefault(); 
            ucWord.style.display='none'; 
            ucInst.style.display='block'; 
            document.getElementById('btn-next-distrib').classList.remove('hidden'); 
        };

        ucHoldBtn.addEventListener('touchstart', showUc, {passive: false});
        ucHoldBtn.addEventListener('touchend', hideUc, {passive: false});
        ucHoldBtn.addEventListener('mousedown', showUc);
        ucHoldBtn.addEventListener('mouseup', hideUc);

        renderUcSetup();
    </script>
</body>
</html>
