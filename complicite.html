<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Complicit√© - ICAM Games</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
</head>
<body>
    <div class="container">
        <div style="padding: 10px 0;"><a href="index.html" style="text-decoration:none; font-size: 1.5rem;">üè†</a></div>
        
        <div id="comp-setup">
            <h1 style="color:var(--neon-blue); text-align:center;">Complicit√©</h1>
            <div class="config-box" style="background:rgba(20,20,20,0.8); padding:20px; border-radius:20px;">
                <label>Objectif de points (0 = Infini)</label>
                <div class="config-row">
                    <input type="number" id="win-score-input" placeholder="Ex: 10" value="10">
                </div>
                
                <label style="margin-top:15px; display:block;">√âquipes</label>
                <div id="teams-container"></div>
                <button class="btn btn-neutral" onclick="addTeam()" style="width:100%; margin-top:10px; border:1px dashed #555;">+ Ajouter √âquipe</button>
            </div>
            <button class="btn btn-primary" onclick="startCompliciteGame()" style="width:100%; margin-top:20px;">LANCER LA PARTIE</button>
        </div>

        <div id="comp-game" class="hidden">
            <div id="scoreboard"></div>
            <div id="turn-indicator" style="text-align:center; margin-bottom:15px; font-weight:bold; color:var(--neon-blue);"></div>

            <div id="word-to-guess" class="word-display">MOT</div>

            <div id="hold-zone" class="hold-zone">
                <div id="hold-instruction">üëÜ MAINTIENS POUR VOIR</div>
            </div>

            <div class="game-controls">
                <button class="btn btn-found" onclick="roundEnd('win')">‚úÖ Trouv√© !</button>
                <button class="btn btn-intercept" onclick="handleStealAttempt()">üòà Intercept√© !</button>
                <button class="btn btn-neutral" onclick="roundEnd('skip')">‚ò†Ô∏è Rat√© / Tabou</button>
            </div>
        </div>
    </div>

    <div id="modal-victory" class="modal-overlay hidden">
        <div class="modal-content">
            <h1 style="font-size:4rem; margin:0;">üèÜ</h1>
            <h2 id="winner-name" style="color:var(--neon-green); font-size:2rem;">VICTOIRE</h2>
            <p style="color:#aaa;">La partie est termin√©e !</p>
            <button class="btn btn-primary" onclick="location.reload()" style="width:100%; margin-top:20px;">REJOUER</button>
        </div>
    </div>

    <script>
    // LISTE DE MOTS MASSIVE (extraite pour la clart√©)
    const baseWords = ["Brosse √† dents", "Micro-ondes", "Zidane", "Pizza", "Batman", "Licorne", "Moustique", "Iphone", "Raclette", "Camping"]; // ... (garde ta liste compl√®te ici)
    let words = [...baseWords];
    let teams = [{ name: "√âquipe A", score: 0 }, { name: "√âquipe B", score: 0 }];
    let winningScore = 0;
    let currentTeamIndex = 0;

    // FONCTION VIBRATION (Pour l'effet "Wahou")
    function vibrate(ms = 20) {
        if (navigator.vibrate) navigator.vibrate(ms);
    }

    function renderSetup() {
        const container = document.getElementById('teams-container');
        container.innerHTML = "";
        teams.forEach((team, index) => {
            const row = document.createElement('div');
            row.className = 'config-row';
            row.innerHTML = `<input type="text" value="${team.name}" onchange="teams[${index}].name = this.value">`;
            container.appendChild(row);
        });
    }

    function addTeam() { 
        vibrate(30);
        teams.push({ name: `√âquipe ${teams.length + 1}`, score: 0 }); 
        renderSetup(); 
    }

    function startCompliciteGame() {
        vibrate([50, 30, 50]); // Triple vibration de lancement
        winningScore = parseInt(document.getElementById('win-score-input').value) || 0;
        document.getElementById('comp-setup').classList.add('hidden');
        document.getElementById('comp-game').classList.remove('hidden');
        nextRound();
    }

    function nextRound() {
        if (words.length === 0) words = [...baseWords];
        const idx = Math.floor(Math.random() * words.length);
        document.getElementById('word-to-guess').innerText = words[idx];
        words.splice(idx, 1);
        updateUI();
    }

    function updateUI() {
        const sb = document.getElementById('scoreboard');
        sb.innerHTML = "";
        teams.forEach((t, idx) => {
            const progress = winningScore > 0 ? (t.score / winningScore) * 100 : 0;
            const div = document.createElement('div');
            div.className = `team-score-box ${idx === currentTeamIndex ? 'team-active' : ''}`;
            div.innerHTML = `
                <span class="ts-val">${t.score}</span>
                <span class="ts-name">${t.name}</span>
                <div style="width:100%; height:4px; background:rgba(255,255,255,0.1); margin-top:8px; border-radius:2px;">
                    <div style="width:${progress}%; height:100%; background:var(--neon-blue); transition:0.5s;"></div>
                </div>
            `;
            sb.appendChild(div);
        });
        document.getElementById('turn-indicator').innerText = `Tour de : ${teams[currentTeamIndex].name}`;
    }

    function roundEnd(type, beneficiaryIndex = null) {
        vibrate(40); // Vibration √† chaque point
        if (type === 'win') teams[currentTeamIndex].score++;
        else if (type === 'steal') teams[beneficiaryIndex].score++;
        
        // V√âRIFICATION VICTOIRE + CONFETTIS
        if (winningScore > 0 && (teams[currentTeamIndex].score >= winningScore || (beneficiaryIndex !== null && teams[beneficiaryIndex].score >= winningScore))) {
            const winner = teams.find(t => t.score >= winningScore);
            document.getElementById('winner-name').innerText = winner.name + " GAGNE !";
            document.getElementById('modal-victory').classList.remove('hidden');
            
            // L'EXPLOSION DE CONFETTIS
            confetti({
                particleCount: 150,
                spread: 70,
                origin: { y: 0.6 },
                colors: ['#00bcd4', '#d500f9', '#00e676']
            });
            return;
        }

        currentTeamIndex = (currentTeamIndex + 1) % teams.length;
        nextRound();
    }

    // --- LOGIQUE DE MAINTIEN AVEC VIBRATION ---
    const holdZone = document.getElementById('hold-zone');
    const wordDisplay = document.getElementById('word-to-guess');

    const show = (e) => {
        if(e.cancelable) e.preventDefault();
        vibrate(10); // Petite secousse quand le mot appara√Æt
        wordDisplay.classList.add('visible');
        holdZone.classList.add('active');
    }
    const hide = () => {
        wordDisplay.classList.remove('visible');
        holdZone.classList.remove('active');
    }

    holdZone.addEventListener('mousedown', show);
    holdZone.addEventListener('mouseup', hide);
    holdZone.addEventListener('touchstart', show, {passive:false});
    holdZone.addEventListener('touchend', hide);

    renderSetup();
</script>
</body>
</html>
