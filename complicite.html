<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Complicit√© - ICAM Games</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <div style="padding: 10px 0;">
            <a href="index.html" style="text-decoration:none; font-size: 1.5rem;">üè†</a>
        </div>
        
        <div id="comp-setup">
            <h1 style="color:var(--neon-blue); text-align:center;">Complicit√©</h1>
            <div class="config-box">
                <label>Objectif de points (0 = Infini)</label>
                <div class="config-row">
                    <input type="number" id="win-score-input" placeholder="Ex: 10" value="10">
                </div>
                
                <label style="margin-top:15px; display:block;">√âquipes</label>
                <div id="teams-container"></div>
                
                <button class="btn btn-neutral" onclick="addTeam()" style="margin-top:10px; border:1px dashed #555;">+ Ajouter √âquipe</button>
            </div>
            <button class="btn btn-primary" onclick="startCompliciteGame()" style="margin-top:20px;">Lancer la partie</button>
        </div>

        <div id="comp-game" class="hidden">
            <div id="scoreboard"></div>
            
            <div id="turn-indicator" style="text-align:center; margin-bottom:15px; font-weight:bold;"></div>

            <div id="word-to-guess" class="word-display">MOT</div>

            <div id="hold-zone" class="hold-zone">
                <div id="hold-instruction">üëÜ MAINTIENS POUR VOIR</div>
            </div>

            <div class="game-controls">
                <button class="btn btn-found" id="btn-win" onclick="roundEnd('win')">‚úÖ Trouv√© !</button>
                <button class="btn btn-intercept" id="btn-steal" onclick="handleStealAttempt()">üòà Intercept√© !</button>
                <button class="btn btn-neutral" onclick="roundEnd('skip')">‚ò†Ô∏è Rat√© / Tabou</button>
            </div>
        </div>
    </div>

    <div id="modal-steal" class="modal-overlay hidden">
        <div class="modal-content">
            <h3 style="color:var(--neon-red)">Qui a vol√© le point ?</h3>
            <div id="steal-buttons-container" class="game-controls"></div>
            <button class="btn btn-neutral" onclick="closeModal('modal-steal')">Annuler</button>
        </div>
    </div>

    <div id="modal-victory" class="modal-overlay hidden">
        <div class="modal-content">
            <h1 style="font-size:3rem;">üèÜ</h1>
            <h2 id="winner-name" style="color:var(--neon-green)">VICTOIRE</h2>
            <button class="btn btn-primary" onclick="resetComplicite()">Rejouer</button>
        </div>
    </div>

    <script>
        const baseWords = ["Brosse √† dents", "Micro-ondes", "Chaussette", "T√©l√©commande", "Canap√©", "Oreiller", "PQ", "Chargeur", "Camping", "Plage", "Prison", "H√¥pital", "Ascenseur", "Pizza", "Raclette", "Sushi", "Ketchup", "Divorce", "Mariage", "Enterrement", "Harry Potter", "Batman", "Zidane", "Macron", "Pigeon", "Moustique", "Licorne", "Dinosaure", "Vomir", "Danser", "Pleurer", "Crier"];
        let words = [...baseWords];
        let teams = [{ id: 1, name: "√âquipe A", score: 0 }, { id: 2, name: "√âquipe B", score: 0 }];
        let winningScore = 0;
        let currentTeamIndex = 0;

        // Gestion du Setup
        function renderSetup() {
            const container = document.getElementById('teams-container');
            container.innerHTML = "";
            teams.forEach((team, index) => {
                const row = document.createElement('div');
                row.className = 'config-row';
                row.innerHTML = `<input type="text" value="${team.name}" onchange="teams[${index}].name = this.value">`;
                if (teams.length > 2) {
                    const btnDel = document.createElement('button');
                    btnDel.innerHTML = "‚úï";
                    btnDel.style = "background:none; border:none; color:red; cursor:pointer; padding:0 10px;";
                    btnDel.onclick = () => removeTeam(index);
                    row.appendChild(btnDel);
                }
                container.appendChild(row);
            });
        }

        function addTeam() { teams.push({ id: Date.now(), name: `√âquipe ${teams.length + 1}`, score: 0 }); renderSetup(); }
        function removeTeam(index) { teams.splice(index, 1); renderSetup(); }

        function startCompliciteGame() {
            winningScore = parseInt(document.getElementById('win-score-input').value) || 0;
            teams.forEach(t => t.score = 0);
            currentTeamIndex = 0;
            document.getElementById('comp-setup').classList.add('hidden');
            document.getElementById('comp-game').classList.remove('hidden');
            nextRound();
        }

        function nextRound() {
            if (words.length === 0) words = [...baseWords];
            const idx = Math.floor(Math.random() * words.length);
            document.getElementById('word-to-guess').innerText = words[idx];
            words.splice(idx, 1);
            updateCompUI();
        }

        function updateCompUI() {
            const sb = document.getElementById('scoreboard');
            sb.innerHTML = "";
            teams.forEach((t, idx) => {
                const div = document.createElement('div');
                div.className = `team-score-box ${idx === currentTeamIndex ? 'team-active' : ''}`;
                div.innerHTML = `<span class="ts-val">${t.score}</span><span class="ts-name">${t.name}</span>`;
                sb.appendChild(div);
            });
            document.getElementById('turn-indicator').innerHTML = `Tour de : <span style="color:var(--neon-blue)">${teams[currentTeamIndex].name}</span>`;
        }

        function handleStealAttempt() {
            if (teams.length === 2) {
                roundEnd('steal', currentTeamIndex === 0 ? 1 : 0);
            } else {
                const container = document.getElementById('steal-buttons-container');
                container.innerHTML = "";
                teams.forEach((t, idx) => {
                    if (idx !== currentTeamIndex) {
                        const btn = document.createElement('button');
                        btn.className = "btn btn-primary";
                        btn.innerText = t.name;
                        btn.onclick = () => { closeModal('modal-steal'); roundEnd('steal', idx); };
                        container.appendChild(btn);
                    }
                });
                document.getElementById('modal-steal').classList.remove('hidden');
            }
        }

        function roundEnd(type, beneficiaryIndex = null) {
            if (type === 'win') teams[currentTeamIndex].score++;
            else if (type === 'steal') teams[beneficiaryIndex].score++;
            
            if (winningScore > 0 && teams.some(t => t.score >= winningScore)) {
                const winner = teams.find(t => t.score >= winningScore);
                document.getElementById('winner-name').innerText = winner.name + " GAGNE !";
                document.getElementById('modal-victory').classList.remove('hidden');
            } else {
                currentTeamIndex = (currentTeamIndex + 1) % teams.length;
                nextRound();
            }
        }

        function resetComplicite() { location.reload(); }
        function closeModal(id) { document.getElementById(id).classList.add('hidden'); }

        // LOGIQUE DE MAINTIEN (HOLD)
        const holdZone = document.getElementById('hold-zone');
        const wordToGuess = document.getElementById('word-to-guess');

        const showWord = (e) => {
            if(e.cancelable) e.preventDefault();
            wordToGuess.classList.add('visible');
            holdZone.classList.add('active');
        };
        const hideWord = () => {
            wordToGuess.classList.remove('visible');
            holdZone.classList.remove('active');
        };

        holdZone.addEventListener('mousedown', showWord);
        holdZone.addEventListener('mouseup', hideWord);
        holdZone.addEventListener('mouseleave', hideWord);
        holdZone.addEventListener('touchstart', showWord, {passive:false});
        holdZone.addEventListener('touchend', hideWord);

        renderSetup();
    </script>
</body>
</html>
