<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Complicit√© - ICAM Games</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <div style="padding: 10px 0;"><a href="index.html" style="text-decoration:none; font-size: 1.5rem;">üè†</a></div>
        
        <div id="comp-setup">
            <h1 style="color:var(--neon-blue); text-align:center;">Complicit√©</h1>
            <div class="config-box">
                <label>Objectif de points</label>
                <div class="config-row">
                    <input type="number" id="win-score-input" value="10">
                </div>
                <label style="margin-top:15px; display:block;">√âquipes</label>
                <div id="teams-container"></div>
                <button class="btn btn-neutral" onclick="addTeam()" style="width:100%; margin-top:10px;">+ Ajouter √âquipe</button>
            </div>
            <button class="btn btn-primary" onclick="startCompliciteGame()" style="width:100%; margin-top:20px;">LANCER LA PARTIE</button>
        </div>

        <div id="comp-game" class="hidden">
            <div id="scoreboard"></div>
            <div id="turn-indicator" style="text-align:center; margin-bottom:15px; font-weight:bold; color:var(--neon-blue);"></div>

            <div id="word-to-guess" class="word-display">MOT</div>

            <div id="hold-zone" class="hold-zone">
                <div id="hold-instruction">üëÜ MAINTIENS POUR VOIR</div>
            </div>

            <div class="game-controls">
                <button class="btn btn-found" onclick="roundEnd('win')">‚úÖ Trouv√© !</button>
                <button class="btn btn-intercept" onclick="handleStealAttempt()">üòà Intercept√© !</button>
                <button class="btn btn-neutral" onclick="roundEnd('skip')">‚ò†Ô∏è Rat√© / Tabou</button>
            </div>
        </div>
    </div>

    <div id="modal-steal" class="modal-overlay hidden">
        <div class="modal-content">
            <h3 style="color:var(--neon-red)">Qui a vol√© le point ?</h3>
            <div id="steal-buttons-container" class="game-controls"></div>
            <button class="btn btn-neutral" onclick="document.getElementById('modal-steal').classList.add('hidden')">Annuler</button>
        </div>
    </div>

    <div id="modal-victory" class="modal-overlay hidden">
        <div class="modal-content">
            <h1 style="font-size:4rem; margin:0;">üèÜ</h1>
            <h2 id="winner-name" style="color:var(--neon-green); font-size:2rem;">VICTOIRE</h2>
            <button class="btn btn-primary" onclick="location.reload()" style="width:100%; margin-top:20px;">REJOUER</button>
        </div>
    </div>

    <script>
        const baseWords = ["Brosse √† dents", "Micro-ondes", "Harry Potter", "Batman", "Zidane", "Pizza", "Raclette", "Sushi", "Pigeon", "Moustique", "Licorne", "Vomir", "Danser", "Iphone", "Lave-vaisselle", "Tondeuse", "Frigo", "Parapluie", "Sac √† dos", "Dentifrice", "Montre", "Basket", "Cravate", "Casquette", "Bonnet", "√âcharpe", "Pull", "Aspirateur", "Po√™le", "Couteau", "Bouteille", "Ordinateur", "Tablette", "Console", "Livre", "Cin√©ma", "Zoo", "Piscine", "Restaurant", "Avion", "V√©lo", "Voiture", "Fus√©e", "Skateboard", "Surf", "Soleil", "Pluie", "Orage", "Arc-en-ciel", "Robot", "Selfie"];
        
        let words = [...baseWords];
        let teams = [{ name: "√âquipe A", score: 0 }, { name: "√âquipe B", score: 0 }];
        let winningScore = 0;
        let currentTeamIndex = 0;

        function renderSetup() {
            const container = document.getElementById('teams-container');
            container.innerHTML = "";
            teams.forEach((team, index) => {
                const row = document.createElement('div');
                row.className = 'config-row';
                row.innerHTML = `<input type="text" value="${team.name}" onchange="teams[${index}].name = this.value">`;
                container.appendChild(row);
            });
        }

        function addTeam() { 
            teams.push({ name: `√âquipe ${teams.length + 1}`, score: 0 }); 
            renderSetup(); 
        }

        function startCompliciteGame() {
            winningScore = parseInt(document.getElementById('win-score-input').value) || 0;
            document.getElementById('comp-setup').classList.add('hidden');
            document.getElementById('comp-game').classList.remove('hidden');
            nextRound();
        }

        function nextRound() {
            if (words.length === 0) words = [...baseWords];
            const idx = Math.floor(Math.random() * words.length);
            document.getElementById('word-to-guess').innerText = words[idx];
            words.splice(idx, 1);
            updateUI();
        }

        function updateUI() {
            const sb = document.getElementById('scoreboard');
            sb.innerHTML = "";
            teams.forEach((t, idx) => {
                const progress = winningScore > 0 ? (t.score / winningScore) * 100 : 0;
                const div = document.createElement('div');
                div.className = `team-score-box ${idx === currentTeamIndex ? 'team-active' : ''}`;
                div.innerHTML = `
                    <span class="ts-val">${t.score}</span>
                    <span class="ts-name">${t.name}</span>
                    <div style="width:100%; height:4px; background:rgba(255,255,255,0.1); margin-top:8px; border-radius:2px; overflow:hidden;">
                        <div style="width:${progress}%; height:100%; background:var(--neon-blue); transition:0.5s;"></div>
                    </div>`;
                sb.appendChild(div);
            });
            document.getElementById('turn-indicator').innerText = `Tour de : ${teams[currentTeamIndex].name}`;
        }

        // --- GESTION DU VOL (FIX√â) ---
        function handleStealAttempt() {
            if (teams.length === 2) {
                // S'il n'y a que 2 √©quipes, l'autre prend le point direct
                roundEnd('steal', currentTeamIndex === 0 ? 1 : 0);
            } else {
                // S'il y a + de 2 √©quipes, on demande qui a vol√©
                const container = document.getElementById('steal-buttons-container');
                container.innerHTML = "";
                teams.forEach((t, idx) => {
                    if (idx !== currentTeamIndex) {
                        const btn = document.createElement('button');
                        btn.className = "btn btn-primary";
                        btn.innerText = t.name;
                        btn.onclick = () => { 
                            document.getElementById('modal-steal').classList.add('hidden');
                            roundEnd('steal', idx); 
                        };
                        container.appendChild(btn);
                    }
                });
                document.getElementById('modal-steal').classList.remove('hidden');
            }
        }

        function roundEnd(type, beneficiaryIndex = null) {
            if (type === 'win') teams[currentTeamIndex].score++;
            else if (type === 'steal') teams[beneficiaryIndex].score++;
            
            // VERIF VICTOIRE + CONFETTIS
            let winner = teams.find(t => winningScore > 0 && t.score >= winningScore);
            if (winner) {
                document.getElementById('winner-name').innerText = winner.name + " GAGNE !";
                document.getElementById('modal-victory').classList.remove('hidden');
                confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
                return;
            }

            currentTeamIndex = (currentTeamIndex + 1) % teams.length;
            nextRound();
        }

        // --- MAINTIEN ---
        const holdZone = document.getElementById('hold-zone');
        const wordDisplay = document.getElementById('word-to-guess');
        const holdInst = document.getElementById('hold-instruction');

        const show = (e) => {
            if(e.cancelable) e.preventDefault();
            wordDisplay.classList.add('visible');
            holdZone.classList.add('active');
            holdInst.style.opacity = "0";
        }
        const hide = () => {
            wordDisplay.classList.remove('visible');
            holdZone.classList.remove('active');
            holdInst.style.opacity = "1";
        }

        holdZone.addEventListener('mousedown', show);
        holdZone.addEventListener('mouseup', hide);
        holdZone.addEventListener('touchstart', show, {passive:false});
        holdZone.addEventListener('touchend', hide);

        renderSetup();
    </script>
</body>
</html>
